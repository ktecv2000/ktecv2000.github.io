---
layout: post
title: Pentest入門心得
categories: pentest
description: pentest
keywords: pentest
---

# Overview

工作了近一個月，期間沒碰多少鑑識，幾乎把時間都拿來打PT了，由於以前都是碰CTF為主，領域又著重在pwn和reversing上，
對web題本來就很沒輒了，何況PT是打一個實際的網站，剛開始對這東西要怎麼做完全沒有概念...
  
邊弄邊學後打了4,5個網站後算是小有心得，也發現其實PT中最難的exploit部分真的是要靠平常打CTF、做研究累積，算是硬知識，而剩下部
分才是經驗為主，雖然相對好學但是沒實際做過真的會一頭霧水，這篇文章就來統整一下目前做PT的步驟以及使用的工具。

---

# Step 0 - Play Around

在開打之前，不應該急著開始，最重要的是把上面的功能都玩過一遍，對整個網站的功能有個大概了解。
     
在這時候可以把Burp打開，用**Target**功能把目標add to scope，好方便觀察這個網站的resources。
![](/images/2019-04-01-learning-pentest/burp_target.PNG)

## Information Gathering
在這個階段主要要獲取的訊息有：
* Interesting function
    * upload
    * download
    * search bar
    * login / register
    * form
* HTTP request / response
    * HTTP method
    * HTTP status code - 403, 500
    * error page
* URL
    * path
    * parameter
* Web architecture
    * front/back end
    * database
    * framework
    * web server
* Source code
* Browser debug console
   
其中幾樣是我做了PT後才發現很重要的，例如**觀察error page**，因為不同的path不只是不同的web resource而已，
他還代表後面對應的[URL Routing](https://dotblogs.com.tw/h091237557/2014/08/14/146260)，不同path對應的error handler可能不一樣，也許根目錄底下的error只是input被WAF擋掉所以噴個400，但另一個路徑下也許就噴一個500出來，順便把debug info也洩漏出來了。
  
另外就是整個Web的架構在開打之前資訊越多越好，總不會後面要測file upload的時候才在猜後面到底是asp還是php，或是要做sql inject
ion結果是MS-SQL還是Oracle都不知道吧...。

### Tools
抓出網站如何架構的超好用的工具[**Wappalyzer**](https://www.wappalyzer.com/)：
   
> Wappalyzer is a cross-platform utility that uncovers the technologies used on websites. It detects CMS(content management systems), ecommerce platforms, web frameworks, server software, analytics tools and many more.
  
還有browser plugin版，真的神器。
  
---

# Step 1 - to Discover
  
蒐集完前面的資訊後，再來就要更進一步去**to Discover**，也就是**刻意**去找出那些開發者不想/不太想讓你知道的訊息：
  
## URIs
  
爆破目錄/檔案的好處有很多，包含：
* 發現實際未routing路徑 - 對於後續file upload/download/inclusion很好用
* 有機會access權限沒設定好的路徑 - 大家最愛的`Index Of`
* 403也是能揭露很多網站架構資訊，例如web.config之於ASP.NET
* 有機會噴出有趣的error - 目前PT做下來看到很多網站常常沒設好web.config，導致某些怪路徑會噴發error洩漏資訊


### Tools

#### Gobuster
```shell
gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 80  -u http://target[.]com/ -k -fw -q -s "200,204,301,403,500"
```

* `-k` - Skip SSL certificate verification
* `-fw` - Force continued operation when wildcard found
* `-q` - Don't print the banner and other noise
* `-s` - Positive status codes (dir mode only) (default "200,204,301,302,307,403")

#### Dirb
不用下其他參數，有時候懶人模式可以先跑這個。

#### Dirbuster
有GUI，進度條很棒，排序起來很方便。
#### wfuzz
因為是fuzzer所以更通用，能滿足許多奇怪payload，有時候status code不準的時候很好用，在要fuzz的地方打上`FUZZ`即可，且不管是GET URL/POST data/Cookie都適用。
```sh
wfuzz -c -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hh 0,668 -u http://target[.]com/FUZZ
```
* `--hc/hl/hw/hh N` - Hide responses with the specified code/lines/words/chars
* `--sc/sl/sw/sh N` - Show responses with the specified code/lines/words/chars
* `-b` cookie
* `-d` postdata - Use post data (ex: "id=FUZZ&catalogue=1")
* `-z` payload - ex: file, range


### Warning!
爆目錄的時候也要考慮一下目標網站負荷能力如何，常常爆個幾次網站也跟著爆了，且實際這種行為是暴露攻擊方的資訊，還是不要過度依賴為好。

## TCP/IP

做PT通常target是針對一個domain，所以subdomain通常是不符合規定的，這時候port scan就很重要了，看一下其他port有沒有好玩的對外服務，例如ssh, telnet, httpd, ftp等等......
  
### Tools
#### nmap
* Port Selection
    |   |   | 
    |---|---|
    | `-p PORT` |  select port *PORT* |  
    | `-p-` |  all 65535 ports |  
    |  `-F` |  100 common ports (Fast) | 
* Service and OS Detection
    |   |   | 
    |---|---|
    | `-A` |  Detect OS and Services |  
    | `-sV [--version-intensity N]` |  *N*=0-5 |  
* TIMING AND PERFORMANCE
    |   |   | 
    |---|---|
    | `-T N` |  N=0-5 (5:fast, dangerous)|  
* NSE Scripts
    |   |   | 
    |---|---|
    | `-sC` |  default |  
    | `--script-help=SCRIPT` |  |  
    | `--script=*` |  |  
    |`locate nse | grep script`| list installed scripts|
* IP Address information
    ```sh
    nmap --script=asn-query,whois,ip-geolocation-maxmind target.com
    ```
#### zenmap
懶人GUI工具
#### [masscan](https://github.com/robertdavidgraham/masscan)
nmap進化版？還沒用來實際打PT過
   
## Google hacking

---

# Step 2 : 




---

<!--
metasploit
弱點掃描軟體
burpsuite
sqlmap

onenote

-->